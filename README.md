# Personal Calculator MCP

MCP(Model Context Protocol)λ¥Ό ν™μ©ν• κ°μΈ κ³„μ‚°κΈ° μ—μ΄μ „νΈ ν”„λ΅μ νΈμ…λ‹λ‹¤. LangChainκ³Ό LangGraphλ¥Ό μ‚¬μ©ν•μ—¬ μμ—°μ–΄λ΅ κ³„μ‚°κΈ°λ¥Ό μ μ–΄ν•  μ μμµλ‹λ‹¤.

## κµ¬μ΅°

```
MCPtest/
β”β”€β”€ server.py        # MCP μ„λ²„ (κ³„μ‚°κΈ° λ„κµ¬ μ κ³µ)
β”β”€β”€ client.py        # μ¤ν¬λ¦½νΈ λ¨λ“ ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ client_cli.py    # λ€ν™”ν• CLI ν΄λΌμ΄μ–ΈνΈ
β”β”€β”€ pyproject.toml   # ν”„λ΅μ νΈ μ„¤μ •
β””β”€β”€ .env_sample      # ν™κ²½λ³€μ μƒν”
```

## κΈ°λ¥

### MCP μ„λ²„ (server.py)
- μ‚¬μ©μ μ΄λ¦„ μ„¤μ •/μ΅°ν
- μ‚¬μΉ™μ—°μ‚° (λ§μ…, λΊ„μ…, κ³±μ…, λ‚λ—μ…)
- κ³„μ‚° κΈ°λ΅ μ΅°ν
- ν†µκ³„ μ •λ³΄ μ΅°ν
- λ„μ  ν•©κ³„ κ³„μ‚°
- κ³„μ‚°κΈ° μ΄κΈ°ν™”

### ν΄λΌμ΄μ–ΈνΈ
- **client.py**: λ―Έλ¦¬ μ •μλ μ‹λ‚λ¦¬μ¤ μμ°¨ μ‹¤ν–‰
- **client_cli.py**: λ€ν™”ν• μΈν„°νμ΄μ¤λ΅ μμ λ΅­κ² μ§μ

## μ„¤μΉ

### μ”κµ¬μ‚¬ν•­
- Python 3.13+
- uv (ν¨ν‚¤μ§€ κ΄€λ¦¬μ)

### μ„¤μΉ λ°©λ²•

```bash
# uv μ„¤μΉ (μ—†λ” κ²½μ°)
curl -LsSf https://astral.sh/uv/install.sh | sh

# ν”„λ΅μ νΈ μμ΅΄μ„± μ„¤μΉ
uv sync
```

## ν™κ²½ μ„¤μ •

`.env_sample`μ„ μ°Έκ³ ν•μ—¬ `.env` νμΌμ„ μƒμ„±ν•μ„Έμ”.

```bash
cp .env_sample .env
```

### ν™κ²½λ³€μ

| λ³€μ | μ„¤λ… |
|------|------|
| `MODEL_NAME` | μ‚¬μ©ν•  λ¨λΈλ… (μ: `gpt-4o`, `Qwen/Qwen3-32B`) |
| `OPENAI_API_KEY` | OpenAI API ν‚¤ (GPT λ¨λΈ μ‚¬μ© μ‹) |
| `CUSTOM_LLM_URL` | μ»¤μ¤ν…€ LLM μ„λ²„ URL (vLLM λ“± μ‚¬μ© μ‹) |

**λ¨λΈ μ„ νƒ:**
- λ¨λΈλ…μ— `gpt`κ°€ ν¬ν•¨λλ©΄ OpenAI API μ‚¬μ©
- κ·Έ μ™Έμ κ²½μ° `CUSTOM_LLM_URL`μ μ»¤μ¤ν…€ LLM μ„λ²„ μ‚¬μ©

## μ‚¬μ©λ²•

### λ€ν™”ν• λ¨λ“ (κ¶μ¥)

```bash
uv run python client_cli.py
```

λ…λ Ήμ–΄:
- μΌλ° μ§λ¬Έμ„ μμ λ΅­κ² μ…λ ¥
- `help`: λ„μ›€λ§ λ³΄κΈ°
- `exit` λλ” `quit`: μΆ…λ£

### μ¤ν¬λ¦½νΈ λ¨λ“

```bash
uv run python client.py
```

λ―Έλ¦¬ μ •μλ μ‹λ‚λ¦¬μ¤λ¥Ό μμ°¨μ μΌλ΅ μ‹¤ν–‰ν•©λ‹λ‹¤.

## μ‚¬μ© μμ‹

```
π’¬ You: λ‚΄ μ΄λ¦„μ€ μ² μμ•Ό
π¤– Bot: μ•λ…•ν•μ„Έμ”, μ² μλ‹! κ³„μ‚°κΈ°λ¥Ό μ‹μ‘ν•©λ‹λ‹¤.

π’¬ You: 5 + 3μ„ κ³„μ‚°ν•΄μ¤
π¤– Bot: μ² μλ‹, 5 + 3 = 8

π’¬ You: 10 Γ— 2λ¥Ό κ³„μ‚°ν•΄μ¤
π¤– Bot: μ² μλ‹, 10 Γ— 2 = 20

π’¬ You: κΈ°λ΅ λ³΄μ—¬μ¤
π¤– Bot: π“ μ² μλ‹μ κ³„μ‚° κΈ°λ΅:
1. add: 5 β†’ 3 = 8
2. multiply: 10 β†’ 2 = 20

π’¬ You: ν†µκ³„ λ³΄μ—¬μ¤
π¤– Bot: π“ μ² μλ‹μ ν†µκ³„:
- μ΄ κ³„μ‚° νμ: 2
- λ„μ  ν•©κ³„: 28
- μ—°μ‚°λ³„ μ‚¬μ© νμ:
  β€Ά add: 1ν
  β€Ά multiply: 1ν
```

## λ™μ‘ μ›λ¦¬

### μ•„ν‚¤ν…μ² κ°μ”

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                        Client                               β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚   User      β”‚β”€β”€β”€β–¶β”‚  ReAct      β”‚β”€β”€β”€β–¶β”‚  MCP Tools     β”‚  β”‚
β”‚  β”‚   Input     β”‚    β”‚  Agent      β”‚    β”‚  (LangChain)   β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”    β””β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                                                β”‚β”‚
                              stdio (stdin/stdout)
                                                β”‚β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”Όβ”Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                     MCP Server                β–Όβ–Ό           β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚  FastMCP (server.py)                               β”‚   β”‚
β”‚  β”‚  - set_user_name, get_user_name                    β”‚   β”‚
β”‚  β”‚  - add, subtract, multiply, divide                 β”‚   β”‚
β”‚  β”‚  - get_history, get_stats, get_total               β”‚   β”‚
β”‚  β”‚  - reset_calculator, reset_all                     β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### MCP μ—°κ²° κ³Όμ •

ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ μ‹ μ„λ²„κ°€ **μλ™μΌλ΅ ν•¨κ» μ‹¤ν–‰**λ©λ‹λ‹¤. λ³„λ„λ΅ μ„λ²„λ¥Ό λ¨Όμ € μ‹¤ν–‰ν•  ν•„μ”κ°€ μ—†μµλ‹λ‹¤.

#### 1. StdioServerParameters μ„¤μ •

```python
self.server_params = StdioServerParameters(
    command="python",
    args=["server.py"],
)
```

`StdioServerParameters`λ” MCP μ„λ²„λ¥Ό subprocessλ΅ μ‹¤ν–‰ν•κ³  **stdin/stdout**μ„ ν†µν•΄ ν†µμ‹ ν•λ” λ°©μ‹μ…λ‹λ‹¤. ν΄λΌμ΄μ–ΈνΈκ°€ `python server.py` λ…λ Ήμ„ μλ™μΌλ΅ μ‹¤ν–‰ν•©λ‹λ‹¤.

#### 2. stdio_clientλ΅ μ—°κ²°

```python
self.stdio_ctx = stdio_client(self.server_params)
read, write = await self.stdio_ctx.__aenter__()
```

`stdio_client`λ” μ„λ²„ ν”„λ΅μ„Έμ¤λ¥Ό μƒμ„±ν•κ³  ν†µμ‹  μ±„λ„(read/write μ¤νΈλ¦Ό)μ„ λ°ν™ν•©λ‹λ‹¤.

#### 3. ClientSession μ΄κΈ°ν™”

```python
self.session_ctx = ClientSession(read, write)
session = await self.session_ctx.__aenter__()
await session.initialize()
```

`ClientSession`μ€ MCP ν”„λ΅ν† μ½μ„ μ²λ¦¬ν•λ” μ„Έμ…μ…λ‹λ‹¤. `initialize()`λ¥Ό νΈμ¶ν•λ©΄ μ„λ²„μ™€ ν•Έλ“μ…°μ΄ν¬λ¥Ό μν–‰ν•κ³ , μ‚¬μ© κ°€λ¥ν• λ„κµ¬ λ©λ΅μ„ κ°€μ Έμµλ‹λ‹¤.

#### 4. MCP λ„κµ¬λ¥Ό LangChain λ„κµ¬λ΅ λ³€ν™

```python
tools = await load_mcp_tools(session)
self.agent = create_react_agent(self.model, tools)
```

`load_mcp_tools`λ” MCP μ„λ²„κ°€ μ κ³µν•λ” λ„κµ¬λ“¤μ„ LangChain νΈν™ ν•μ‹μΌλ΅ λ³€ν™ν•©λ‹λ‹¤. μ΄ λ„κµ¬λ“¤μ„ ReAct μ—μ΄μ „νΈμ— μ—°κ²°ν•λ©΄, LLMμ΄ μμ—°μ–΄ μ§λ¬Έμ„ λ¶„μ„ν•μ—¬ μ μ ν• λ„κµ¬λ¥Ό μλ™μΌλ΅ νΈμ¶ν•©λ‹λ‹¤.

### ν†µμ‹  λ°©μ‹ λΉ„κµ

| λ°©μ‹ | μ„¤λ… | μ‚¬μ© μ‚¬λ΅€ |
|------|------|----------|
| **stdio** | subprocess + stdin/stdout | λ΅μ»¬ μ‹¤ν–‰ (ν„μ¬ ν”„λ΅μ νΈ) |
| **SSE** | HTTP Server-Sent Events | μ›κ²© μ„λ²„ μ—°κ²° |
| **WebSocket** | μ–‘λ°©ν–¥ μ‹¤μ‹κ°„ ν†µμ‹  | μ‹¤μ‹κ°„ μ¤νΈλ¦¬λ° |

ν„μ¬ ν”„λ΅μ νΈλ” **stdio** λ°©μ‹μ„ μ‚¬μ©ν•λ―€λ΅, ν΄λΌμ΄μ–ΈνΈμ™€ μ„λ²„κ°€ κ°™μ€ λ¨Έμ‹ μ—μ„ μ‹¤ν–‰λ©λ‹λ‹¤.

## μμ΅΄μ„±

- `fastmcp`: MCP μ„λ²„ ν”„λ μ„μ›ν¬
- `mcp`: MCP ν΄λΌμ΄μ–ΈνΈ
- `langchain`: LLM ν”„λ μ„μ›ν¬
- `langchain-mcp-adapters`: MCP-LangChain μ–΄λ‘ν„°
- `langchain-openai`: OpenAI μ—°λ™
- `langgraph`: ReAct μ—μ΄μ „νΈ